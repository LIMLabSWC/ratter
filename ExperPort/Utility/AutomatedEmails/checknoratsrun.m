function checknoratsrun(slots,varargin)

try 
    
    [RN RG TS] = bdata(['select ratname, rig, timeslot from ratinfo.schedule where date="',datestr(now,29),'"']);
    [RR CT]    = bdata('select ratname, contact from ratinfo.rats where extant=1');
    RS         = bdata(['select ratname from sessions where sessiondate="',datestr(now,29),'"']);
    [EX EM LM OT MT AT SA] = bdata('select experimenter, email, lab_manager, tech_overnight, tech_morning, tech_afternoon, subscribe_all from ratinfo.contacts where is_alumni=0');
    
    setpref('Internet','SMTP_Server','sonnabend.princeton.edu');
    setpref('Internet','E_mail','ScheduleMeister@Princeton.EDU');
    
    if nargin == 0; slots = 1:9; end
    urg = unique(RG);      
    
    E = cell(0);
    output = []; %#ok<NASGU>

    aratdidrun = 0;
    for slot = slots
        for rig = urg'
            rn = RN{RG == rig & TS == slot};
            if strcmp(rn,''); continue; end
            
            if sum(strcmp(RS,rn)) > 0; aratdidrun = 1; 
            else                       E{end+1} = rn; %#ok<AGROW>
            end            
        end
    end

    E = unique(E);
    
    email = cell(0);
    if aratdidrun == 0 && ~isempty(E)
        message = cell(0);
        message{end+1} = ['No rats appeared to run today in sessions ',num2str(slots)];
        message{end+1} = 'Please contact the appropriate tech and make sure someone';
        message{end+1} = 'gives the rats their 1 hour of free water.';
        message{end+1} = ' ';
        message{end+1} = 'Thanks,';
        message{end+1} = 'The Schedule Meister';
        message{end+1} = '  ';                                                             
        message{end+1} = '  ';                                                             
        message{end+1} = 'This email was generated by the Brody Lab Automated Email System.';
        IP = get_network_info;
        message{end+1} = ' ';
        if ischar(IP); message{end+1} = ['Email generated by ',IP];
        else           message{end+1} = 'Email generated by an unknown computer!!!';
        end
        
        for e = 1:length(E)
            temp = strcmp(RR,E{e});
            if sum(temp) == 1
                ct = CT{temp};
                em = parse_emails(ct);
            
                for t = 1:length(em)
                    email{end+1} = [em{t},'@princeton.edu']; %#ok<AGROW>
                end
            end
        end
        
        if sum(SA) + sum(LM) > 0
            temp = EM(SA==1 | LM==1);
            email(end+1:end+length(temp)) = temp;
        end
        if any(slots <= 3) 
            temp = EM(OT==1);
            email(end+1:end+length(temp)) = temp;
        end
        if any(slots >= 4 & slots <= 6) 
            temp = EM(MT==1);
            email(end+1:end+length(temp)) = temp;
        end
        if any(slots <= 9) 
            temp = EM(AT==1);
            email(end+1:end+length(temp)) = temp;
        end
        email = unique(email);
         
        for e = 1:length(email)
            ex = EX(strcmp(EM,email{e}));
            try %#ok<TRYNC>
                eval(['output.',ex,' = message;']);
            end
        end
        
        message = remove_duplicate_lines(message);
        sendmail(email,'No Rats Ran Today',message);    
    end
    
    LTR = 'abcdefghijklmnopqrstuvwxyz';
    for ltr = 1:26
        file = ['C:\Automated Emails\Schedule\NoRun\',yearmonthday,LTR(ltr),'_NoRatsRan_Email.mat'];
        if ~exist(file,'file'); save(file,'output'); break; end    
    end

catch %#ok<CTCH>
    senderror_report;
end





